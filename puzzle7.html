<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Puzzle 7 — Finale</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Puzzle 7 — Finale</h1>

    <p class="clue">
Since It's clear only you two care
About finishing these puzzles
If you dare
I've changed them around
To fit your flair

What do you enter
When you get to a house
Of one of you two
And you put that together
With another thing too
The level I am at
In only the best game
That has a zoo
Don't know?
That's a shame
…
Oh you thought that was it?
Oh no…
Alas
You’ll need a third thing
It requires some class
The third number is
1001011

And now that you have got 
A, b, and c
You'll need to solve this thing
To get the information from me ;)


    </p>

    <p class="meta">Variables: <strong>A = 1225</strong>, <strong>B = 23</strong>, <strong>C = 75</strong></p>

    <section aria-labelledby="problem">
      <div class="section-title" id="problem">Problem</div>
      <p>
        Let
      </p>

      <pre class="math">
f(x) = A \ln\big(Bx + C\big)
      </pre>

      <p>
        Find the integer <strong>D</strong> such that the slope of the tangent to \(f\) at \(x=D\) equals \(B\); that is,
      </p>

      <pre class="math">
f'(D) = B.
      </pre>
    </section>

    <div class="input-row">
      <input id="answer" type="text" placeholder="Your answer">
      <button id="submitBtn">Submit</button>
    </div>

    <div id="feedback" class="feedback small"></div>

    <!-- HINT UI -->
    <div style="margin-top:10px;">
      <button id="hintBtn" class="small">Show Hint</button>
    </div>
    <div id="hintBox" class="reveal" style="display:none; margin-top:8px;">
      <div id="hint-content">
        <!-- Put your hint text for puzzle 7 here -->
        Think about the . and - in the last 5 lines.
      </div>
    </div>

    <div class="reveal">
      <strong>Progress:</strong>
      <div id="progressText" style="margin-top:8px;font-family:monospace;"></div>
    </div>

    <button class="reset small reset" id="resetBtn">Reset progress (testing)</button>
  </div>

  <script>
    const expectedNormalized = "tessamakaylaadorastellansantisky".trim().toLowerCase().replace(/\s+/g, "");
    const chunk = " b"; 
    const nextPage = "puzzle8.html";

    const attemptsKey = "attempts_puzzle7";
    const HINT_THRESHOLD = 3;
    function getAttempts(){ return parseInt(sessionStorage.getItem(attemptsKey) || "0", 10); }
    function setAttempts(n){ sessionStorage.setItem(attemptsKey, String(n)); }
    function incrementAttempts(){ const n = getAttempts()+1; setAttempts(n); if(n>=HINT_THRESHOLD) showHint(); }
    function showHint(){ const btn=document.getElementById("hintBtn"), box=document.getElementById("hintBox"); if(!box||!btn) return; box.style.display="block"; btn.textContent="Hide Hint"; }
    function hideHint(){ const btn=document.getElementById("hintBtn"), box=document.getElementById("hintBox"); if(!box||!btn) return; box.style.display="none"; btn.textContent="Show Hint"; }
    document.getElementById("hintBtn").addEventListener("click", () => {
      const box = document.getElementById("hintBox");
      if (box.style.display === "none" || !box.style.display) showHint();
      else hideHint();
    });
    if (getAttempts() >= HINT_THRESHOLD) showHint();

    function normalize(s){ return s.trim().toLowerCase().replace(/\s+/g, ""); }
    function showProgress(){
      const revealed = JSON.parse(localStorage.getItem("revealChunks") || "[]");
      const display = revealed.join("") || "[ nothing revealed yet ]";
      document.getElementById("progressText").textContent = display;
    }

    document.getElementById("submitBtn").addEventListener("click", () => {
      const raw = document.getElementById("answer").value || "";
      const norm = normalize(raw);
      const fb = document.getElementById("feedback");
      if (norm === expectedNormalized) {
        fb.textContent = "✅ Correct! Unlocking final piece...";
        const arr = JSON.parse(localStorage.getItem("revealChunks") || "[]");
        if (!arr.includes(chunk)) { arr.unshift(chunk); localStorage.setItem("revealChunks", JSON.stringify(arr)); }
        setTimeout(()=> window.location.href = nextPage, 700);
      } else {
        fb.textContent = "❌ Try again. Attempts: " + getAttempts();
        incrementAttempts();
      }
      showProgress();
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("revealChunks");
      sessionStorage.removeItem(attemptsKey);
      showProgress();
      document.getElementById("feedback").textContent = "Progress reset.";
    });

    showProgress();
  </script>
</body>
</html>
