<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Puzzle 7</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Puzzle 7 — Finale</h1>

    <p class="clue">
And now the finale
You've made it quite far
But the answer that's here
Is one you might not know 
I fear
It's a sad little story
Of a sad little thing
That happened quite long ago
(I need a min)
Can you tell me the name?
I really need to know
Of the dog that I lost
And you just might be ready to go
She was kind
She was sweet
And a kinda bit white
If you ate the verisimilar
It might give you a fright
I'll say it again
She was golden brown
Also used to bake cookies
For those all around town
    </p>

    <div class="input-row">
      <input id="answer" type="text" placeholder="Your answer">
      <button id="submitBtn">Submit</button>
    </div>

    <div id="feedback" class="feedback small"></div>

    <!-- HINT UI (paste under the feedback div) -->
    <div style="margin-top:10px;">
      <button id="hintBtn" class="small">Show Hint</button>
    </div>

    <div id="hintBox" class="reveal" style="display:none; margin-top:8px;">
      <div id="hint-content">
        <!-- Put your hint text here. Edit this text manually. -->
        Line 18 and 17 refer to Salt.
      </div>
    </div>

    <div class="reveal">
      <strong>Progress:</strong>
      <div id="progressText" style="margin-top:8px;font-family:monospace;"></div>
    </div>

    <button class="reset small reset" id="resetBtn">Reset progress (for testing)</button>
  </div>

  <script>
    const correctHash = "cc767fb1c6efc232caf9dd1f6e853d853b58ddd2c058c8820320e69d755c18fb";
    const chunk = "DPHS hom";
    const nextPage = "complete.html";

    async function sha256Hex(message) {
      const msgUint8 = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    function showProgress() {
      const revealed = JSON.parse(localStorage.getItem("revealChunks") || "[]");
      const display = revealed.join("") || "[ nothing revealed yet ]";
      document.getElementById("progressText").textContent = display;
    }

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const raw = document.getElementById("answer").value;
      const normalized = raw.trim().toLowerCase();
      const h = await sha256Hex(normalized);
      const fb = document.getElementById("feedback");
      if (h === correctHash) {
        fb.textContent = "✅ Correct! Unlocking final piece...";
        const arr = JSON.parse(localStorage.getItem("revealChunks") || "[]");
        if (!arr.includes(chunk)) { // prevent duplicates
          arr.unshift(chunk); 
          localStorage.setItem("revealChunks", JSON.stringify(arr));
        }
        setTimeout(() => window.location.href = nextPage, 700);
      } else {
        fb.textContent = "❌ Try again.";
      }
      showProgress();
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("revealChunks");
      showProgress();
      document.getElementById("feedback").textContent = "Progress reset.";
    });

    showProgress();

    // HINT helper (paste into the page's <script> area)
    const attemptsKey = "attempts_" + (location.pathname.split("/").pop().replace(".html","") || "puzzle"); // unique per page
    const HINT_THRESHOLD = 3; // number of wrong tries before auto-show
    
    function getAttempts() {
      return parseInt(sessionStorage.getItem(attemptsKey) || "0", 10);
    }
    function setAttempts(n) {
      sessionStorage.setItem(attemptsKey, String(n));
    }
    function incrementAttempts() {
      const n = getAttempts() + 1;
      setAttempts(n);
      if (n >= HINT_THRESHOLD) showHint();
      // optional: display attempts in feedback area (uncomment if desired)
      // document.getElementById("feedback").textContent += `  (attempts: ${n})`;
    }
    
    function showHint() {
      const btn = document.getElementById("hintBtn");
      const box = document.getElementById("hintBox");
      if (!box || !btn) return;
      box.style.display = "block";
      btn.textContent = "Hide Hint";
    }
    function hideHint() {
      const btn = document.getElementById("hintBtn");
      const box = document.getElementById("hintBox");
      if (!box || !btn) return;
      box.style.display = "none";
      btn.textContent = "Show Hint";
    }
    
    document.getElementById("hintBtn").addEventListener("click", () => {
      const box = document.getElementById("hintBox");
      if (box.style.display === "none" || !box.style.display) showHint();
      else hideHint();
    });

  </script>
</body>
</html>
