<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Puzzle 4</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Puzzle 4</h1>

    <p class="clue">
Hi, blondie
I know what you did
She knows it too
What you made an accident
All comes back to you
Now tell me
Alas
What was her name?
That you murdered that night
With little
 to no shame
    </p>

    <div class="input-row">
      <input id="answer" type="text" placeholder="Your answer">
      <button id="submitBtn">Submit</button>
    </div>

    <div id="feedback" class="feedback small"></div>

    <!-- HINT UI -->
    <div style="margin-top:10px;">
      <button id="hintBtn" class="small">Show Hint</button>
    </div>
    <div id="hintBox" class="reveal" style="display:none; margin-top:8px;">
      <div id="hint-content">
        <!-- Put your hint text for puzzle 4 here -->
         If you think you have the wrong spelling, text/call me. Not after 12AM, please.
      </div>
    </div>

    <div class="reveal">
      <strong>Progress:</strong>
      <div id="progressText" style="margin-top:8px;font-family:monospace;"></div>
    </div>

    <button class="reset small reset" id="resetBtn">Reset progress (testing)</button>
  </div>

  <script>
    const expectedNormalized = "geraldine".trim().toLowerCase().replace(/\s+/g, "");
    const chunk = "PM, "; // delimiter between time and month
    const nextPage = "puzzle5.html";

    const attemptsKey = "attempts_puzzle4";
    const HINT_THRESHOLD = 3;
    function getAttempts(){ return parseInt(sessionStorage.getItem(attemptsKey) || "0", 10); }
    function setAttempts(n){ sessionStorage.setItem(attemptsKey, String(n)); }
    function incrementAttempts(){ const n = getAttempts()+1; setAttempts(n); if(n>=HINT_THRESHOLD) showHint(); }
    function showHint(){ const btn=document.getElementById("hintBtn"), box=document.getElementById("hintBox"); if(!box||!btn) return; box.style.display="block"; btn.textContent="Hide Hint"; }
    function hideHint(){ const btn=document.getElementById("hintBtn"), box=document.getElementById("hintBox"); if(!box||!btn) return; box.style.display="none"; btn.textContent="Show Hint"; }
    document.getElementById("hintBtn").addEventListener("click", () => {
      const box = document.getElementById("hintBox");
      if (box.style.display === "none" || !box.style.display) showHint();
      else hideHint();
    });
    if (getAttempts() >= HINT_THRESHOLD) showHint();

    function normalize(s){ return s.trim().toLowerCase().replace(/\s+/g, ""); }
    function showProgress(){
      const revealed = JSON.parse(localStorage.getItem("revealChunks") || "[]");
      const display = revealed.join("") || "[ nothing revealed yet ]";
      document.getElementById("progressText").textContent = display;
    }

    document.getElementById("submitBtn").addEventListener("click", () => {
      const raw = document.getElementById("answer").value || "";
      const norm = normalize(raw);
      const fb = document.getElementById("feedback");
      if (norm === expectedNormalized) {
        fb.textContent = "✅ Correct! Unlocking next piece...";
        const arr = JSON.parse(localStorage.getItem("revealChunks") || "[]");
        if (!arr.includes(chunk)) { arr.unshift(chunk); localStorage.setItem("revealChunks", JSON.stringify(arr)); }
        setTimeout(()=> window.location.href = nextPage, 700);
      } else {
        fb.textContent = "❌ Try again.";
        incrementAttempts();
      }
      showProgress();
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("revealChunks");
      sessionStorage.removeItem(attemptsKey);
      showProgress();
      document.getElementById("feedback").textContent = "Progress reset.";
    });

    showProgress();
  </script>
</body>
</html>
