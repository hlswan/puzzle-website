<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Puzzle 1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Puzzle 1</h1>

    <p class="clue">
What time is it?

Some man in the group knows
Not the engineer
Nor HeWhoMustNotBeNamed
But the one who did that thing
With the reeds
And the looooong Wednesdays
    </p>

    <div class="input-row">
      <input id="answer" type="text" placeholder="Your answer">
      <button id="submitBtn">Submit</button>
    </div>

    <div id="feedback" class="feedback small"></div>

    <div class="reveal">
      <strong>Progress:</strong>
      <div id="progressText" style="margin-top:8px;font-family:monospace;"></div>
    </div>

    <button class="reset small reset" id="resetBtn">Reset progress (for testing)</button>
  </div>

  <script>
    // Puzzle 1 expects normalized answer "8:07"
    const correctHash = "b657338f3ce4ab774c6964d0ef976adb7655ab8fc3d4c41c7fc7f3f532d62a95";
    const chunk = ", 2025";         // chunk assigned for puzzle 1
    const nextPage = "puzzle2.html";

    async function sha256Hex(message) {
      const msgUint8 = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    function showProgress() {
      const revealed = JSON.parse(localStorage.getItem("revealChunks") || "[]");
      const display = revealed.join("") || "[ nothing revealed yet ]";
      document.getElementById("progressText").textContent = display;
    }

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const raw = document.getElementById("answer").value;
      const normalized = raw.trim().toLowerCase();
      const h = await sha256Hex(normalized);
      const fb = document.getElementById("feedback");
      if (h === correctHash) {
        fb.textContent = "✅ Correct! Unlocking next piece...";
        const arr = JSON.parse(localStorage.getItem("revealChunks") || "[]");
        // only add if not already revealed at this index
        if (arr.length < 1) { arr.push(chunk); localStorage.setItem("revealChunks", JSON.stringify(arr)); }
        setTimeout(() => window.location.href = nextPage, 700);
      } else {
        fb.textContent = "❌ Try again.";
      }
      showProgress();
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("revealChunks");
      showProgress();
      document.getElementById("feedback").textContent = "Progress reset.";
    });

    // show progress on load
    showProgress();
  </script>
</body>
</html>
